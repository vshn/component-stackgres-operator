apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    argocd.argoproj.io/hook: PreSync
  generateName: cleanCertificatesJob-
spec:
  template:
    spec:
      containers:
        - args: []
          command:
            - /bin/bash
            - -cex
            - |
              #!/bin/bash

              kubectl -n "$NAMESPACE" delete clusterrolebindings.rbac.authorization.k8s.io stackgres-operator-init

              kubectl -n "$NAMESPACE" delete certs --all

              kubectl -n "$NAMESPACE" delete secrets stackgres-operator-certs stackgres-operator-web-certs

              kubectl -n "$NAMESPACE" delete issuers.cert-manager.io stackgres-operator-ca-issuer stackgres-operator-self-signed-issuer
          env:
            - NAMESPACE: syn-stackgres-operator
          image: docker.io/bitnami/kubectl:1.24
          name: kubectl
      restartPolicy: OnFailure
      serviceAccountName: cluster-admin
